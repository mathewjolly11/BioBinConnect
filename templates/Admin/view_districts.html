{% extends "Admin/base.html" %}
{% load static %}
{% block content %}
{% if messages %}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            {% for message in messages %}
                Swal.fire({
                    icon: '{{ message.tags|default:'info' }}',
                    title: '{{ message.tags|capfirst }}',
                    text: '{{ message }}',
                    timer: 2000,
                    showConfirmButton: false,
                    customClass: {
                        popup: 'swal2-bootstrap4 swal2-rounded',
                        title: 'swal2-title-custom',
                        confirmButton: 'btn btn-primary',
                        cancelButton: 'btn btn-danger'
                    },
                    buttonsStyling: false
                });
            {% endfor %}
        });
    </script>
    <style>
        .swal2-popup.swal2-bootstrap4 {
            font-family: 'Roboto', 'Arial', sans-serif;
            border-radius: 0.75rem;
        }
        .swal2-title-custom {
            color: #3085d6;
            font-weight: 600;
        }
    </style>
{% endif %}
<section id="main-content">
    <section class="wrapper main-wrapper">
        <div class="col-lg-8 offset-lg-2">
            <section class="box">
                <header class="panel_header">
                    <h2 class="title text-center">Districts List</h2>
                </header>
                <div class="content-body">
                    <div class="row justify-content-center">
                        <div class="col-md-12">
                            <table class="table table-bordered table-hover">
                                <thead class="thead-light">
                                    <tr>
                                        <th>Serial No</th>
                                        <th>District Name</th>
                                        <th class="text-center">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for district in districts %}
                                    <tr>
                                        <td>{{ forloop.counter }}</td>
                                        <td>{{ district.District_Name }}</td>
                                        <td class="text-center">
                                            <a href="{% url 'edit_district' district.pk  %}" class="btn btn-sm btn-warning swal-edit">Edit</a>
                                            <a href="#" data-href="{% url 'delete_district' district.pk %}" class="btn btn-sm btn-danger swal-delete">Delete</a>
                                        </td>
                                    </tr>
                                    {% empty %}
                                    <tr>
                                        <td colspan="3" class="text-center">No districts found.</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </section>
</section>
<script>
    // SweetAlert2 for Delete
    document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('.swal-delete').forEach(function(btn) {
            btn.addEventListener('click', function(e) {
                e.preventDefault();
                const url = btn.getAttribute('data-href');
                Swal.fire({
                    title: 'Are you sure?',
                    text: "You won't be able to revert this!",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Yes, delete it!'
                }).then((result) => {
                    if (result.isConfirmed) {
                        window.location.href = url;
                    }
                });
            });
        });

        // SweetAlert2 for Edit: redirect immediately, show success after edit
        document.querySelectorAll('.swal-edit').forEach(function(btn) {
            btn.addEventListener('click', function(e) {
                e.preventDefault();
                // Set flag to show success after edit
                localStorage.setItem('editSuccess', '1');
                window.location.href = btn.getAttribute('href');
            });
        });

        // Show edit success if coming back from edit
        if (localStorage.getItem('editSuccess') === '1' && window.location.search.indexOf('edit=success') !== -1) {
            Swal.fire({
                icon: 'success',
                title: 'Edit Success',
                text: 'District edited successfully!'
            });
            localStorage.removeItem('editSuccess');
        }
    });
</script>
{% endblock %}