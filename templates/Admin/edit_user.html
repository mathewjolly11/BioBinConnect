{% extends "Admin/base.html" %}
{% load static %}
{% block content %}
<section id="main-content">
    <section class="wrapper main-wrapper">
        <div class="col-lg-12">
            <section class="box">
                <header class="panel_header">
                    <h2 class="title text-center">Edit User - {{ user.name }}</h2>
                </header>
                <div class="content-body">
                    <div class="row">
                        <div class="col-md-8 offset-md-2">
                            <form method="POST" action="{% url 'edit_user' user.id %}">
                                {% csrf_token %}
                                
                                <!-- Basic User Information -->
                                <div class="card mb-4">
                                    <div class="card-header bg-primary text-white">
                                        <h5 class="mb-0"><i class="fa fa-user"></i> Basic Information</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="form-group mb-3">
                                            <label for="name">Full Name <span class="text-danger">*</span></label>
                                            <input type="text" class="form-control" id="name" name="name" 
                                                   value="{{ user.name }}" required>
                                        </div>
                                        
                                        <div class="form-group mb-3">
                                            <label for="email">Email <span class="text-danger">*</span></label>
                                            <input type="email" class="form-control" id="email" name="email" 
                                                   value="{{ user.email }}" required>
                                        </div>
                                        
                                        <div class="form-group mb-3">
                                            <label for="phone">Phone</label>
                                            <input type="text" class="form-control" id="phone" name="phone" 
                                                   value="{{ user.phone|default:'' }}">
                                        </div>
                                        
                                        <div class="form-group mb-3">
                                            <label>Role</label>
                                            <input type="text" class="form-control" 
                                                   value="{% if user.role == 'household' %}Household{% elif user.role == 'collector' %}Collector{% elif user.role == 'compost_manager' %}Compost Manager{% elif user.role == 'farmer' %}Farmer{% endif %}" 
                                                   readonly>
                                        </div>
                                        
                                        <div class="form-group mb-3">
                                            <label>Verification Status</label>
                                            <div>
                                                {% if user.is_verified %}
                                                <span class="badge badge-success"><i class="fa fa-check"></i> Verified</span>
                                                {% else %}
                                                <span class="badge badge-warning"><i class="fa fa-clock-o"></i> Pending</span>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Role-Specific Information -->
                                {% if role_details %}
                                <div class="card mb-4">
                                    <div class="card-header bg-info text-white">
                                        <h5 class="mb-0"><i class="fa fa-info-circle"></i> Role-Specific Details</h5>
                                    </div>
                                    <div class="card-body">
                                        {% if user.role == 'household' %}
                                            <div class="form-group mb-3">
                                                <label for="household_name">Household Name <span class="text-danger">*</span></label>
                                                <input type="text" class="form-control" id="household_name" name="household_name" 
                                                       value="{{ role_details.household_name }}" required>
                                            </div>
                                            
                                            <div class="form-group mb-3">
                                                <label for="role_phone">Contact Phone <span class="text-danger">*</span></label>
                                                <input type="text" class="form-control" id="role_phone" name="role_phone" 
                                                       value="{{ role_details.phone }}" required>
                                            </div>
                                            
                                            <div class="form-group mb-3">
                                                <label for="house_no">House Number</label>
                                                <input type="number" class="form-control" id="house_no" name="house_no" 
                                                       value="{{ role_details.house_no|default:'' }}">
                                            </div>
                                            
                                            <div class="form-group mb-3">
                                                <label for="district">District <span class="text-danger">*</span></label>
                                                <select class="form-control" id="district" name="district" required>
                                                    {% for district in districts %}
                                                    <option value="{{ district.District_id }}" 
                                                            {% if role_details.district.District_id == district.District_id %}selected{% endif %}>
                                                        {{ district.District_Name }}
                                                    </option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                            
                                            <div class="form-group mb-3">
                                                <label for="location">Location <span class="text-danger">*</span></label>
                                                <select class="form-control" id="location" name="location" required>
                                                    {% for location in locations %}
                                                    <option value="{{ location.Location_id }}" 
                                                            {% if role_details.location.Location_id == location.Location_id %}selected{% endif %}>
                                                        {{ location.Ward_Name }}
                                                    </option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                            
                                            <div class="form-group mb-3">
                                                <label for="residents_association">Residents Association <span class="text-danger">*</span></label>
                                                <select class="form-control" id="residents_association" name="residents_association" required>
                                                    {% for ra in residents_associations %}
                                                    <option value="{{ ra.RA_id }}" 
                                                            {% if role_details.residents_association.RA_id == ra.RA_id %}selected{% endif %}>
                                                        {{ ra.Association_Name }}
                                                    </option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                            
                                            <div class="form-group mb-3">
                                                <label for="address">Address <span class="text-danger">*</span></label>
                                                <textarea class="form-control" id="address" name="address" rows="3" required>{{ role_details.address }}</textarea>
                                            </div>
                                            
                                        {% elif user.role == 'collector' %}
                                            <div class="form-group mb-3">
                                                <label for="collector_name">Collector Name <span class="text-danger">*</span></label>
                                                <input type="text" class="form-control" id="collector_name" name="collector_name" 
                                                       value="{{ role_details.collector_name }}" required>
                                            </div>
                                            
                                            <div class="form-group mb-3">
                                                <label for="role_phone">Contact Phone <span class="text-danger">*</span></label>
                                                <input type="text" class="form-control" id="role_phone" name="role_phone" 
                                                       value="{{ role_details.phone }}" required>
                                            </div>
                                            
                                            <div class="form-group mb-3">
                                                <label for="address">Address <span class="text-danger">*</span></label>
                                                <textarea class="form-control" id="address" name="address" rows="3" required>{{ role_details.address }}</textarea>
                                            </div>
                                            
                                        {% elif user.role == 'compost_manager' %}
                                            <div class="form-group mb-3">
                                                <label for="compostmanager_name">Manager Name <span class="text-danger">*</span></label>
                                                <input type="text" class="form-control" id="compostmanager_name" name="compostmanager_name" 
                                                       value="{{ role_details.compostmanager_name }}" required>
                                            </div>
                                            
                                            <div class="form-group mb-3">
                                                <label for="role_phone">Contact Phone <span class="text-danger">*</span></label>
                                                <input type="text" class="form-control" id="role_phone" name="role_phone" 
                                                       value="{{ role_details.phone }}" required>
                                            </div>
                                            
                                            <div class="form-group mb-3">
                                                <label for="license_number">License Number <span class="text-danger">*</span></label>
                                                <input type="text" class="form-control" id="license_number" name="license_number" 
                                                       value="{{ role_details.license_number }}" required>
                                            </div>
                                            
                                            <div class="form-group mb-3">
                                                <label for="address">Address <span class="text-danger">*</span></label>
                                                <textarea class="form-control" id="address" name="address" rows="3" required>{{ role_details.address }}</textarea>
                                            </div>
                                            
                                        {% elif user.role == 'farmer' %}
                                            <div class="form-group mb-3">
                                                <label for="farmer_name">Farmer Name <span class="text-danger">*</span></label>
                                                <input type="text" class="form-control" id="farmer_name" name="farmer_name" 
                                                       value="{{ role_details.farmer_name }}" required>
                                            </div>
                                            
                                            <div class="form-group mb-3">
                                                <label for="role_phone">Contact Phone <span class="text-danger">*</span></label>
                                                <input type="text" class="form-control" id="role_phone" name="role_phone" 
                                                       value="{{ role_details.phone }}" required>
                                            </div>
                                            
                                            <div class="form-group mb-3">
                                                <label for="address">Address <span class="text-danger">*</span></label>
                                                <textarea class="form-control" id="address" name="address" rows="3" required>{{ role_details.address }}</textarea>
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                                {% endif %}
                                
                                <!-- Action Buttons -->
                                <div class="form-group text-center">
                                    <a href="{% url 'view_users' %}" class="btn btn-secondary">
                                        <i class="fa fa-times"></i> Cancel
                                    </a>
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fa fa-save"></i> Save Changes
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </section>
</section>

<style>
    .card {
        border: 1px solid #ddd;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .card-header {
        border-radius: 8px 8px 0 0;
        padding: 15px;
    }
    
    .card-body {
        padding: 20px;
    }
    
    .form-group label {
        font-weight: 600;
        color: #495057;
        margin-bottom: 8px;
    }
    
    .form-control {
        border-radius: 6px;
        border: 1px solid #ced4da;
        padding: 10px 12px;
    }
    
    .form-control:focus {
        border-color: #80bdff;
        box-shadow: 0 0 0 0.2rem rgba(0,123,255,.25);
    }
    
    .btn {
        padding: 10px 24px;
        border-radius: 6px;
        font-weight: 600;
        margin: 0 5px;
    }
    
    .text-danger {
        color: #dc3545;
    }
    
    .badge {
        padding: 8px 12px;
        font-size: 14px;
        border-radius: 4px;
    }
</style>
{% endblock %}
