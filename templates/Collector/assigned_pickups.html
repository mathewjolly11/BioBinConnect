{% extends 'Collector/base.html' %} {% load static %} {% block content %}
<section id="section-hero" class="no-bottom" aria-label="section">
  <div class="d-flex align-items-center flex-col">
    <div class="col-md-8 text-center pt-50 pb-20">
      <h1 class="wow fadeInUp" data-wow-delay=".3s">Assigned Pickups</h1>
      <p class="lead wow fadeInUp" data-wow-delay=".4s">
        Manage your upcoming collection schedule.
      </p>
    </div>
  </div>
</section>

<section id="section-content" class="no-top">
  <div class="container">
    <div class="row">
      <div class="col-md-10 offset-md-1">
        <div class="p-4 bg-white wow fadeInUp rounded shadow-sm">
          <div class="table-responsive">
            <table class="table table-striped table-hover">
              <thead class="bg-light">
                <tr>
                  <th>ID</th>
                  <th>Date</th>
                  <th>Household</th>
                  <th>Address</th>
                  <th>Status</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody>
                {% for req in assignments %}
                <tr>
                  <td>#{{ req.Pickup_id }}</td>
                  <td>{{ req.scheduled_date }}</td>
                  <td>
                    <strong>{{ req.household.household_name }}</strong><br />
                    <small class="text-muted"
                      >House #{{ req.household.house_no }}</small
                    >
                  </td>
                  <td>
                    <small>{{ req.household.address }}</small><br />
                    <small>{{ req.household.residents_association }}</small>
                  </td>
                  <td>
                    {% if req.status == 'Pending' %}
                    <span class="badge bg-warning text-dark">Pending</span>
                    {% elif req.status == 'Approved' %}
                    <span class="badge bg-info text-dark">Scheduled</span>
                    {% endif %}
                  </td>
                  <td>
                    <a
                      href="{% url 'log_collection' req.Pickup_id %}"
                      class="btn-main btn-sm"
                      >Log Collection</a
                    >
                  </td>
                </tr>
                {% empty %}
                <tr>
                  <td colspan="6" class="text-center py-4">
                    No pending assignments found.
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    {% if messages %}
    {% for message in messages %}
    {% if message.tags == 'success' %}
    Swal.fire({
      icon: 'success',
      title: 'Collection Logged Successfully!',
      text: '{{ message }}',
      confirmButtonText: 'OK',
      confirmButtonColor: '#6c9a2e',
      timer: 5000,
      timerProgressBar: true
    });
    {% elif message.tags == 'error' %}
    Swal.fire({
      icon: 'error',
      title: 'Error!',
      text: '{{ message }}',
      confirmButtonText: 'OK',
      confirmButtonColor: '#ef4444'
    });
    {% endif %}
    {% endfor %}
    {% endif %}
  });
</script>

{% endblock %}
