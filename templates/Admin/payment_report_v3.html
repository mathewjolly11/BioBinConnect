{% extends 'Admin/base.html' %}
{% load static %}

{% block content %}
<section id="main-content" class=" ">
    <section class="wrapper main-wrapper">

        <div class='col-xl-12 col-lg-12 col-md-12 col-12'>
            <div class="page-title">
                <div class="float-left">
                    <h1 class="title">Payment Report</h1>
                </div>

                <div class="float-right d-none d-sm-block">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item">
                            <a href="{% url 'admin_index' %}"><i class="fa fa-home"></i>Home</a>
                        </li>
                        <li class="breadcrumb-item">
                            <a href="#">Reports</a>
                        </li>
                        <li class="breadcrumb-item active">
                            <strong>Payment Info</strong>
                        </li>
                    </ol>
                </div>
            </div>
        </div>
        <div class="clearfix"></div>

        <div class="col-xl-12">
            <section class="box nobox">
                <div class="content-body">

                    <!-- Summary Cards -->
                    <div class="row margin-bottom-30">
                        <div class="col-md-3">
                            <div class="card bg-primary text-white">
                                <div class="card-body text-center" style="padding: 20px;">
                                    <h3 class="mb-0 text-white">₹{{ today_total|floatformat:2 }}</h3>
                                    <p class="mb-0 text-white">Today's Revenue</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-success text-white">
                                <div class="card-body text-center" style="padding: 20px;">
                                    <h3 class="mb-0 text-white">{{ today_count }}</h3>
                                    <p class="mb-0 text-white">Today's Payments</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-info text-white">
                                <div class="card-body text-center" style="padding: 20px;">
                                    <h3 class="mb-0 text-white">{{ today_completed }}</h3>
                                    <p class="mb-0 text-white">Completed Today</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-warning text-white">
                                <div class="card-body text-center" style="padding: 20px;">
                                    <h3 class="mb-0 text-white">₹{{ all_total|floatformat:2 }}</h3>
                                    <p class="mb-0 text-white">Total Revenue</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Filter Form -->
                    <div class="row margin-bottom-30">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-header">
                                    <h4 class="card-title">Filter Payments</h4>
                                </div>
                                <div class="card-body" style="padding: 30px;">
                                    <form method="get" class="row align-items-end" style="gap: 15px;">
                                        <div class="col-md-3">
                                            <label class="form-label" style="margin-bottom: 8px; font-weight: 600;">From Date</label>
                                            <input type="date" name="from_date" class="form-control"
                                                value="{{ from_date }}" style="height: 42px; font-size: 14px;">
                                        </div>
                                        <div class="col-md-3">
                                            <label class="form-label" style="margin-bottom: 8px; font-weight: 600;">To Date</label>
                                            <input type="date" name="to_date" class="form-control"
                                                value="{{ to_date }}" style="height: 42px; font-size: 14px;">
                                        </div>
                                        <div class="col-md-3">
                                            <label class="form-label" style="margin-bottom: 8px; font-weight: 600;">Status</label>
                                            <select name="status" class="form-control" style="height: 42px; font-size: 14px; padding: 8px 30px 8px 12px;">
                                                <option value="">All Status</option>
                                                <option value="Completed" {% if check_completed %}selected{% endif %}>
                                                    Completed
                                                </option>
                                                <option value="Pending" {% if check_pending %}selected{% endif %}>
                                                    Pending
                                                </option>
                                                <option value="Failed" {% if status == 'Failed' %}selected{% endif %}>
                                                    Failed
                                                </option>
                                            </select>
                                        </div>
                                        <div class="col-md-2">
                                            <button type="submit" class="btn btn-primary" 
                                                style="height: 42px; width: 100%; font-size: 14px; font-weight: 600;">
                                                Filter
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Payment Table -->
                    <div class="row">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <h4 class="card-title">Payment Transactions</h4>
                                    <!-- Use 'btn btn-secondary' or similar helper classes instead of 'btn-line' if not defined -->
                                    <a href="{% url 'export_payment_report' %}?from_date={{ from_date }}&to_date={{ to_date }}&status={{ status }}"
                                        class="btn btn-success btn-sm" style="float: right; background-color: #10B981; border-color: #10B981; color: white;">
                                        <i class="fa fa-file-excel-o"></i> Export to Excel
                                    </a>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-striped table-hover">
                                            <thead class="bg-light">
                                                <tr>
                                                    <th>SL NO</th>
                                                    <th>Date</th>
                                                    <th>Household</th>
                                                    <th>Bin Type</th>
                                                    <th>Amount</th>
                                                    <th>Transaction ID</th>
                                                    <th>Status</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for payment in payments %}
                                                <tr>
                                                    <td>{{ forloop.counter }}</td>
                                                    <td>{{ payment.payment_date|date:"Y-m-d H:i" }}</td>
                                                    <td>
                                                        <strong>{{ payment.household.household_name }}</strong><br>
                                                        <small>House #{{ payment.household.house_no }}</small>
                                                    </td>
                                                    <td>{{ payment.bin_type.name }}</td>
                                                    <td><strong>₹{{ payment.amount }}</strong></td>
                                                    <td><code>{{ payment.transaction_id }}</code></td>
                                                    <td>
                                                        {% if payment.status == 'Completed' %}
                                                        <span class="badge badge-success">Completed</span>
                                                        {% else %}
                                                        <span class="badge badge-warning">Pending</span>
                                                        {% endif %}
                                                    </td>
                                                </tr>
                                                {% empty %}
                                                <tr>
                                                    <td colspan="7" class="text-center py-4">No payments found for the
                                                        selected
                                                        filters.
                                                    </td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                            <tfoot class="bg-light">
                                                <tr>
                                                    <th colspan="4" class="text-right" style="text-align: right;">Total:
                                                    </th>
                                                    <th>₹{{ filtered_total|floatformat:2 }}</th>
                                                    <th colspan="2">{{ payments|length }} payments</th>
                                                </tr>
                                            </tfoot>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </section>
        </div>

    </section>
</section>

<style>

    /* Clean layout styling */
    .card {
        overflow: visible !important;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .card-body {
        overflow: visible !important;
        position: relative;
    }
    
    .form-control {
        border: 1px solid #e0e0e0;
        border-radius: 6px;
        transition: border-color 0.3s ease;
        box-sizing: border-box;
    }
    
    .form-control:focus {
        border-color: #007bff;
        box-shadow: 0 0 0 2px rgba(0,123,255,0.25);
        outline: none;
    }
    
    /* Select dropdown specific styling */
    select.form-control {
        appearance: auto;
        -webkit-appearance: menulist;
        -moz-appearance: menulist;
        background-color: #fff;
        cursor: pointer;
    }
    
    /* Button styling */
    .btn-primary {
        background-color: #28a745;
        border-color: #28a745;
        border-radius: 6px;
        font-weight: 600;
        transition: all 0.3s ease;
    }
    
    .btn-primary:hover {
        background-color: #218838;
        border-color: #218838;
        transform: translateY(-1px);
    }
    
    /* Form row alignment */
    .row.align-items-end {
        margin: 0;
    }
    
    .row.align-items-end > * {
        padding: 0 8px;
    }
    
    /* Label styling */
    .form-label {
        color: #333;
        font-size: 14px;
        margin-bottom: 8px;
    }
    
    /* Responsive improvements */
    @media (max-width: 768px) {
        .row.align-items-end {
            flex-direction: column;
        }
        
        .row.align-items-end > * {
            width: 100%;
            margin-bottom: 20px;
        }
    }
</style>
</style>
{% endblock %}